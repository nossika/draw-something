webpackJsonp([0],{767:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,r,l,o,u=a(94),i=n(u),c=a(91),f=n(c),d=a(92),m=n(d),p=a(95),v=n(p),h=a(96),k=n(h),y=a(249),E=n(y),g=a(9),b=n(g),N=a(16),w=n(N),_=a(23),S=a(93),C=a(250),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(C),x=a(771),R=n(x),P=a(770),$=n(P),O=a(769),I=n(O),D=a(773),W=a(253),H=a(252),V=function(e){return b.default.createElement("div",null,e.map(function(e){switch(e.type){case"enter":case"leave":return b.default.createElement("div",{className:"message",key:e.timestamp+e.type},b.default.createElement("div",{className:"info system"},b.default.createElement("span",{className:"by"},(0,W.getPersonName)(e.by)," ",{enter:"进入房间",leave:"离开房间"}[e.type])));case"info-change":return b.default.createElement("div",{className:"message",key:e.timestamp},b.default.createElement("div",{className:"info system"},b.default.createElement("span",{className:"by"},e.content.old.name," 改名为 ",e.content.info.name)));case"message":return b.default.createElement("div",{className:"message",key:e.timestamp},b.default.createElement("div",{className:"info"},b.default.createElement("span",{className:"by"},(0,W.getPersonName)(e.by)),b.default.createElement("span",{className:"time"},(0,D.getFormatTime)(e.timestamp,"HMS"))),b.default.createElement("div",{className:"content"},e.content));default:return null}}))},j=(s=(0,S.connect)(function(e){return{currentRoom:e.room.currentRoom,user:e.user}},function(e){return(0,_.bindActionCreators)((0,E.default)({},M),e)}))((o=l=function(e){function t(){var e,a,n,s;(0,f.default)(this,t);for(var r=arguments.length,l=Array(r),o=0;o<r;o++)l[o]=arguments[o];return a=n=(0,v.default)(this,(e=t.__proto__||(0,i.default)(t)).call.apply(e,[this].concat(l))),n.state={messageInputValue:""},s=a,(0,v.default)(n,s)}return(0,k.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=this,t=this.props.currentRoom,a=t.owner,n=t.people,s=t.name;return b.default.createElement("section",null,b.default.createElement($.default,{key:"header",title:s,type:"room"}),b.default.createElement("section",{className:"room-container"},b.default.createElement("section",{className:"game-block"},b.default.createElement(R.default,{key:"game"})),b.default.createElement("section",{className:"people-block"},b.default.createElement("div",{title:"房主"},b.default.createElement("span",null,(0,W.getPersonName)(a),b.default.createElement("span",{className:"host-marker"},"(房主)"))),b.default.createElement("div",null,n.filter(function(e){return a&&e.id!==a.id}).map(function(e,t){var a=(0,W.getPersonName)(e);return b.default.createElement("div",{key:e.id},b.default.createElement("span",{title:a},a))}))),b.default.createElement("section",{className:"chat-block"},b.default.createElement("section",{className:"message-wrapper",ref:"message-wrapper"},V(t.messageList)),b.default.createElement("section",{className:"input-wrapper input-group input-btn"},b.default.createElement("input",{className:"input input-default input-md",placeholder:"请输入内容",value:this.state.messageInputValue,onChange:function(t){var a=t.target.value;e.setState({messageInputValue:a})},onKeyDown:function(t){return 13===t.keyCode&&e.sendMessage()}}),b.default.createElement("span",{className:"btn btn-default btn-md"+(this.state.messageInputValue?"":" disabled"),onClick:this.sendMessage.bind(this)},"发送")))))}},{key:"sendMessage",value:function(){this.state.messageInputValue&&(I.default.sendRoomMessage(this.state.messageInputValue),this.setState({messageInputValue:""}))}},{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.roomName,n=t.currentRoom;this.message$$=H.message$.subscribe(function(t){e.refs["message-wrapper"].scrollTop=e.refs["message-wrapper"].scrollHeight}),n&&n.name===a||(document.title="你画我猜online - "+a,I.default.enterRoom(a))}},{key:"componentWillUnmount",value:function(){this.message$$.unsubscribe()}}]),t}(g.Component),l.propTypes={roomName:w.default.string.isRequired},r=o))||r;t.default=j},769:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(254),l=s(r),o=a(147),u=s(o),i=a(148),c=s(i),f=a(250),d=n(f),m=a(144),p=(n(m),a(146)),v=n(p),h=a(251),k=(n(h),a(252));t.default={enterRoom:function(e){l.default.emit("enterRoom",e,function(){c.default.dispatch(d.setRoomInfo({roomName:e}))})},leaveRoom:function(){l.default.emit("leaveRoom"),c.default.dispatch(d.setRoomInfo({roomName:""}))},sendRoomMessage:function(e){var t=c.default.getState().user;l.default.emit("sendRoomMessage",e,function(a){a.ok&&k.message$.next({content:e,by:t,timestamp:a.timestamp,type:"message"})})},startGame:function(){l.default.emit("startGame")},emitCanvasStroke:function(e){l.default.emit("canvasStroke",e)},setUserInfo:function(e){l.default.emit("setClientInfo",e,function(t){u.default.set("clientInfo",e,6048e5),c.default.dispatch(v.setUserData({info:e}))})}}},770:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,r,l,o,u=a(94),i=n(u),c=a(91),f=n(c),d=a(92),m=n(d),p=a(95),v=n(p),h=a(96),k=n(h),y=a(249),E=n(y),g=a(9),b=n(g),N=a(23),w=a(93),_=a(145),S=a(144),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(S),M=a(769),x=n(M),R=(s=(0,w.connect)(function(e){return{loadingStatus:e.network.loadingStatus,webSocketStatus:e.network.webSocketStatus,user:e.user}},function(e){return(0,N.bindActionCreators)((0,E.default)({},C),e)}))((o=l=function(e){function t(){var e,a,n,s;(0,f.default)(this,t);for(var r=arguments.length,l=Array(r),o=0;o<r;o++)l[o]=arguments[o];return a=n=(0,v.default)(this,(e=t.__proto__||(0,i.default)(t)).call.apply(e,[this].concat(l))),n.state={nameEditable:!1,nameValue:""},s=a,(0,v.default)(n,s)}return(0,k.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=this,t=this.props,a=(t.loadingStatus,t.webSocketStatus),n=(t.loading,t.loaded,t.wsConnect,t.wsDisconnect,t.user),s=t.title,r=t.type;return b.default.createElement("section",{className:"fixed-header"},b.default.createElement("div",{className:"item left"},a?null:b.default.createElement("span",{className:"item wifi alert-color",title:"网络出错"},b.default.createElement("svg",{className:"icon","aria-hidden":"true"},b.default.createElement("use",{xlinkHref:"#icon-wifi"}))),b.default.createElement("span",null,function(e){switch(e){case"home":return null;case"room":return b.default.createElement(_.Link,{to:"/"},b.default.createElement("span",{className:"icon-wrapper"},b.default.createElement("svg",{className:"icon clickable","aria-hidden":"true"},b.default.createElement("use",{xlinkHref:"#icon-back"}))));default:return null}}(r)),b.default.createElement("span",null,"room"===r?b.default.createElement("span",null,"房间：",b.default.createElement("span",{className:"room-name"},s)):b.default.createElement("span",null,s))),b.default.createElement("div",{className:"item right",onClick:this.switchInfoEditable.bind(this)},this.state.nameEditable?[b.default.createElement("span",{key:"icon",className:"icon-wrapper"},b.default.createElement("svg",{className:"icon","aria-hidden":"true"},b.default.createElement("use",{xlinkHref:"#icon-people"}))),b.default.createElement("input",{key:"input",className:"input input-white input-md",value:this.state.nameValue,onChange:function(t){e.setState({nameValue:t.target.value})},onKeyDown:function(t){13===t.keyCode&&e.setName()}}),b.default.createElement("span",{key:"confirm",className:"icon-wrapper",onClick:this.setName.bind(this)},b.default.createElement("svg",{className:"icon clickable","aria-hidden":"true"},b.default.createElement("use",{xlinkHref:"#icon-roundcheck"}))),b.default.createElement("span",{key:"cancel",className:"icon-wrapper",onClick:function(){e.setState({nameEditable:!1})}},b.default.createElement("svg",{className:"icon clickable","aria-hidden":"true"},b.default.createElement("use",{xlinkHref:"#icon-roundclose"})))]:b.default.createElement("div",{title:"点击修改昵称",className:"clickable"},b.default.createElement("span",{className:"icon-wrapper"},b.default.createElement("svg",{style:{stroke:"#fff",fill:"#fff"},className:"icon","aria-hidden":"true"},b.default.createElement("use",{xlinkHref:"#icon-people"}))),b.default.createElement("span",null,n.info.name||n.id))))}},{key:"componentWillMount",value:function(){}},{key:"switchInfoEditable",value:function(){this.state.nameEditable||this.setState({nameEditable:!0,nameValue:this.props.user.info.name||this.props.user.id})}},{key:"setName",value:function(){this.props.user.info.name!==this.state.nameValue&&x.default.setUserInfo({name:this.state.nameValue}),this.setState({nameEditable:!1})}}]),t}(g.Component),l.defaultProps={type:""},r=o))||r;t.default=R},771:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,r,l=a(94),o=n(l),u=a(91),i=n(u),c=a(92),f=n(c),d=a(95),m=n(d),p=a(96),v=n(p),h=a(249),k=n(h),y=a(9),E=n(y),g=a(23),b=a(93),N=a(772),w=n(N),_=a(66),S=n(_),C=a(769),M=n(C),x=a(257),R=a(251),P=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(R),$=a(253),O=a(149),I=function(e){var t=[];for(var a in e){var n=e[a];t.push(n)}return t.sort(function(e,t){return e.score>t.score?-1:1}),t=t.map(function(e,t){return E.default.createElement("div",{key:e.id,className:"table-row"},E.default.createElement("span",{className:"rank"},t+1),E.default.createElement("span",{title:(0,$.getPersonName)(e),className:"name"+(e.online?" on":" off")},(0,$.getPersonName)(e)),E.default.createElement("span",{className:"score"},e.score))})},D=(s=(0,b.connect)(function(e){return{game:e.game,user:e.user,currentRoom:e.room.currentRoom}},function(e){return(0,g.bindActionCreators)((0,k.default)({},P),e)}))(r=function(e){function t(){var e,a,n,s;(0,i.default)(this,t);for(var r=arguments.length,l=Array(r),u=0;u<r;u++)l[u]=arguments[u];return a=n=(0,m.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(l))),n.state={color:"#000"},n.redrawCanvas=function(){var e=this.refs.canvas;e.width=e.offsetWidth,e.height=e.offsetHeight,this.brush.redraw(this.props.game.canvasData.strokes)}.bind(n),s=a,(0,m.default)(n,s)}return(0,v.default)(t,e),(0,f.default)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.game,n=t.user,s=t.currentRoom,r=a.word,l=a.countDown,o=a.banker,u=a.players,i=a.status,c=s.owner,f=c&&n.id===c.id;o&&(o.id,c.id);return E.default.createElement("section",{className:"game-wrapper"},E.default.createElement("section",{className:"game-info"},E.default.createElement("div",{className:"tip"},{pending:"等待下个回合",going:"进行中",await:"等待房主开始游戏"}[i]),"await"===i?null:[E.default.createElement("div",{key:"word",className:"row"},E.default.createElement("span",{className:"key"},"目标词语"),E.default.createElement("span",{className:"value key-word"},r||"?")),E.default.createElement("div",{key:"time",className:"row"},E.default.createElement("span",{className:"key"},{pending:"下个回合",going:"剩余时间"}[i]),E.default.createElement("span",{className:"value"},l||"")),E.default.createElement("div",{key:"host",className:"row"},E.default.createElement("span",{className:"key"},"庄家"),E.default.createElement("span",{className:"value"},(0,$.getPersonName)(o)))],"await"===i&&f?E.default.createElement("div",{className:"starter"},E.default.createElement("span",{className:"btn btn-default btn-md",onClick:M.default.startGame},"开始游戏")):null,E.default.createElement("div",{className:"rank-wrapper"},E.default.createElement("div",{key:"",className:"table-row"},E.default.createElement("span",{className:"rank"},"排名"),E.default.createElement("span",{className:"name"},"玩家"),E.default.createElement("span",{className:"score"},"积分")),I(u))),E.default.createElement("section",{className:"game-panel"},E.default.createElement("canvas",{className:"canvas",ref:"canvas",width:"600",height:"400",style:{cursor:"going"===i&&o&&o.id===n.id?"crosshair":"default"}}),E.default.createElement("div",{className:"controls",ref:"controls"},O.strokeColors.map(function(t){return E.default.createElement("div",{key:t,style:{background:t},className:"color-brush "+(e.state.color===t?"active":""),onClick:function(){e.syncStroke({type:"mode",mode:"brush"}),e.syncStroke({type:"color",color:t})}})}),E.default.createElement("div",{className:"color-brush eraser",title:"撤销",onClick:function(){e.syncStroke({type:"revoke"})}}))))}},{key:"componentWillMount",value:function(){var e=this.props,t=e.setGameStatus,a=e.setGameCountDown,n=e.setGameBanker,s=e.setGamePlayers,r=e.setGameWord,l=e.setCanvasData;t("await"),a(0),n(null),s({}),r(""),l({strokes:[]})}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.redrawCanvas),this.brush=new w.default({canvas:this.refs.canvas}),this.canvasStroke$$=x.canvasStroke$.subscribe(function(t){return e.syncStroke(t,!0)}),this.canvasReset$$=x.canvasReset$.subscribe(function(){return e.resetCanvas()}),this.mouseEvent$$=S.default.Observable.fromEvent(this.refs.canvas,"mousedown").do(function(t){e.syncStroke({x:t.offsetX/e.refs.canvas.offsetWidth,y:t.offsetY/e.refs.canvas.offsetHeight,type:"begin"})}).switchMap(function(t){return S.default.Observable.fromEvent(e.refs.canvas,"mousemove").takeUntil(S.default.Observable.fromEvent(document.body,"mouseup").do(function(t){e.syncStroke({type:"close"})}))}).do(function(t){e.syncStroke({x:t.offsetX/e.refs.canvas.offsetWidth,y:t.offsetY/e.refs.canvas.offsetHeight,type:"move"})}).subscribe(),setTimeout(function(){e.redrawCanvas()})}},{key:"componentWillUnmount",value:function(){this.mouseEvent$$.unsubscribe(),this.canvasReset$$.unsubscribe(),this.canvasStroke$$.unsubscribe(),window.removeEventListener("resize",this.redrawCanvas)}},{key:"syncStroke",value:function(e,t){var a=this.props,n=a.game,s=a.user,r=a.pushCanvasStroke;(t||"going"===n.status&&n.banker&&n.banker.id===s.id)&&("color"===e.type?this.setState({color:e.color}):"mode"===e.type&&"eraser"===e.mode&&this.setState({color:"_eraser"}),r(e),this.brush.exec(e),!t&&M.default.emitCanvasStroke(e))}},{key:"resetCanvas",value:function(){(0,this.props.setCanvasData)({size:[this.refs.canvas.width,this.refs.canvas.height],strokes:[]}),this.setState({color:"#000"}),this.brush.redraw()}}]),t}(y.Component))||r;t.default=D},772:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(256),r=n(s),l=a(91),o=n(l),u=a(92),i=n(u),c=function(){function e(t){var a=t.canvas,n=t.lineWidth,s=void 0===n?4:n,r=t.color,l=void 0===r?"red":r;(0,o.default)(this,e),this.ctx=a.getContext("2d"),this.mode="brush",this.ctx.strokeStyle=l,this.ctx.lineWidth=s,this.strokes=[]}return(0,i.default)(e,[{key:"redraw",value:function(e){e=(e||[]).slice();var t=void 0;e:for(;-1!==(t=e.findIndex(function(e){return"revoke"===e.type}));){var a=0,n=t-1;e.splice(t,1);for(var s=t-1;s>=0;s--)if("close"===e[s].type)n=s;else if("begin"===e[s].type){a=s,e.splice(a,n-a+1);continue e}}this.strokes=e;var l=this.ctx.canvas,o=l.width,u=l.height;this.ctx.clearRect(0,0,o,u),this.ctx.strokeStyle="#000";var i=!0,c=!1,f=void 0;try{for(var d,m=(0,r.default)(e);!(i=(d=m.next()).done);i=!0){var p=d.value;this.draw(p)}}catch(e){c=!0,f=e}finally{try{!i&&m.return&&m.return()}finally{if(c)throw f}}}},{key:"exec",value:function(e){this.strokes.push(e),"revoke"===e.type?this.redraw(this.strokes):this.draw(e)}},{key:"draw",value:function(e){var t=this.ctx,a=t.canvas,n=a.width,s=a.height,r=e.x*n,l=e.y*s;switch(e.type){case"mode":this.mode=e.mode;break;case"color":this.ctx.strokeStyle=e.color;break;case"begin":t.beginPath(),t.moveTo(r,l),t.stroke();break;case"move":switch(this.mode){case"brush":t.lineTo(r,l),t.stroke();break;case"eraser":t.clearRect(r-10*t.lineWidth,l-10*t.lineWidth,20*t.lineWidth,20*t.lineWidth)}break;case"close":t.closePath()}}}]),e}();t.default=c},773:function(e,t,a){"use strict";function n(e){return e=+e,e<=9?"0"+e:""+e}Object.defineProperty(t,"__esModule",{value:!0});t.getFormatTime=function(e,t){if(!e)return"";e=new Date(e);var a=[e.getFullYear(),n(e.getMonth()+1),n(e.getDate())],s=a[0],r=a[1],l=a[2],o=[n(e.getHours()),n(e.getMinutes()),n(e.getSeconds())],u=o[0],i=o[1],c=o[2];return"HMS"===t?u+":"+i+":"+c:"YMD"===t?s+"-"+r+"-"+l:s+"-"+r+"-"+l+" "+u+":"+i+":"+c}}});
//# sourceMappingURL=chunk.0.9cb54ca13aeb81bb31e8.js.map